{"version":3,"sources":["../../../src/api/claude-api-errors.ts"],"sourcesContent":["/**\n * Claude API specific error types with enhanced error handling\n */\n\nimport { ClaudeFlowError } from '../utils/errors.js';\n\n/**\n * Base error class for Claude API errors\n */\nexport class ClaudeAPIError extends ClaudeFlowError {\n  constructor(\n    message: string,\n    public readonly statusCode?: number,\n    public readonly retryable: boolean = false,\n    details?: unknown,\n  ) {\n    super(message, 'CLAUDE_API_ERROR', details);\n    this.name = 'ClaudeAPIError';\n  }\n}\n\n/**\n * Error for 500 Internal Server Error\n */\nexport class ClaudeInternalServerError extends ClaudeAPIError {\n  constructor(message: string, details?: unknown) {\n    super(\n      message || 'Claude API internal server error. The service may be temporarily unavailable.',\n      500,\n      true, // Retryable\n      details,\n    );\n    this.name = 'ClaudeInternalServerError';\n  }\n}\n\n/**\n * Error for 503 Service Unavailable\n */\nexport class ClaudeServiceUnavailableError extends ClaudeAPIError {\n  constructor(message: string, details?: unknown) {\n    super(\n      message || 'Claude API service is temporarily unavailable. Please try again later.',\n      503,\n      true, // Retryable\n      details,\n    );\n    this.name = 'ClaudeServiceUnavailableError';\n  }\n}\n\n/**\n * Error for 429 Too Many Requests (Rate Limit)\n */\nexport class ClaudeRateLimitError extends ClaudeAPIError {\n  constructor(\n    message: string,\n    public readonly retryAfter?: number,\n    details?: unknown,\n  ) {\n    super(\n      message || 'Rate limit exceeded. Please wait before making more requests.',\n      429,\n      true, // Retryable\n      details,\n    );\n    this.name = 'ClaudeRateLimitError';\n  }\n}\n\n/**\n * Error for network timeouts\n */\nexport class ClaudeTimeoutError extends ClaudeAPIError {\n  constructor(message: string, public readonly timeout: number, details?: unknown) {\n    super(\n      message || `Request timed out after ${timeout}ms. The API may be slow or unreachable.`,\n      undefined,\n      true, // Retryable\n      details,\n    );\n    this.name = 'ClaudeTimeoutError';\n  }\n}\n\n/**\n * Error for network-related issues\n */\nexport class ClaudeNetworkError extends ClaudeAPIError {\n  constructor(message: string, details?: unknown) {\n    super(\n      message || 'Network error occurred. Please check your internet connection.',\n      undefined,\n      true, // Retryable\n      details,\n    );\n    this.name = 'ClaudeNetworkError';\n  }\n}\n\n/**\n * Error for authentication issues\n */\nexport class ClaudeAuthenticationError extends ClaudeAPIError {\n  constructor(message: string, details?: unknown) {\n    super(\n      message || 'Authentication failed. Please check your API key.',\n      401,\n      false, // Not retryable\n      details,\n    );\n    this.name = 'ClaudeAuthenticationError';\n  }\n}\n\n/**\n * Error for invalid requests\n */\nexport class ClaudeValidationError extends ClaudeAPIError {\n  constructor(message: string, details?: unknown) {\n    super(\n      message || 'Invalid request. Please check your parameters.',\n      400,\n      false, // Not retryable\n      details,\n    );\n    this.name = 'ClaudeValidationError';\n  }\n}\n\n/**\n * Health check result\n */\nexport interface HealthCheckResult {\n  healthy: boolean;\n  latency?: number;\n  error?: string;\n  timestamp: Date;\n}\n\n/**\n * User-friendly error messages and fallback suggestions\n */\nexport const ERROR_MESSAGES = {\n  INTERNAL_SERVER_ERROR: {\n    title: 'Claude API Service Error',\n    message: 'The Claude API is experiencing technical difficulties.',\n    suggestions: [\n      'Wait a few minutes and try again',\n      'Check the Anthropic status page for service updates',\n      'Consider using a fallback AI service if available',\n      'Cache previous responses for offline usage',\n    ],\n  },\n  SERVICE_UNAVAILABLE: {\n    title: 'Service Temporarily Unavailable',\n    message: 'Claude API is temporarily unavailable or undergoing maintenance.',\n    suggestions: [\n      'Try again in 5-10 minutes',\n      'Check if there\\'s scheduled maintenance',\n      'Use cached responses if available',\n      'Consider implementing a queue for requests',\n    ],\n  },\n  RATE_LIMIT: {\n    title: 'Rate Limit Exceeded',\n    message: 'You\\'ve made too many requests to the Claude API.',\n    suggestions: [\n      'Implement request throttling',\n      'Batch multiple requests together',\n      'Consider upgrading your API plan',\n      'Use exponential backoff for retries',\n    ],\n  },\n  TIMEOUT: {\n    title: 'Request Timeout',\n    message: 'The request took too long to complete.',\n    suggestions: [\n      'Check your internet connection',\n      'Try a simpler request',\n      'Increase the timeout duration',\n      'Break large requests into smaller ones',\n    ],\n  },\n  NETWORK_ERROR: {\n    title: 'Network Connection Error',\n    message: 'Unable to connect to the Claude API.',\n    suggestions: [\n      'Check your internet connection',\n      'Verify firewall/proxy settings',\n      'Try using a different network',\n      'Check if the API endpoint is correct',\n    ],\n  },\n  AUTHENTICATION: {\n    title: 'Authentication Failed',\n    message: 'Unable to authenticate with the Claude API.',\n    suggestions: [\n      'Verify your API key is correct',\n      'Check if your API key has expired',\n      'Ensure the API key has proper permissions',\n      'Generate a new API key if needed',\n    ],\n  },\n  VALIDATION: {\n    title: 'Invalid Request',\n    message: 'The request contains invalid parameters.',\n    suggestions: [\n      'Check the request parameters',\n      'Verify the model name is correct',\n      'Ensure message format is valid',\n      'Review the API documentation',\n    ],\n  },\n};\n\n/**\n * Get user-friendly error information\n */\nexport function getUserFriendlyError(error: ClaudeAPIError): {\n  title: string;\n  message: string;\n  suggestions: string[];\n  retryable: boolean;\n} {\n  let errorInfo = ERROR_MESSAGES.INTERNAL_SERVER_ERROR; // Default\n  \n  if (error instanceof ClaudeInternalServerError) {\n    errorInfo = ERROR_MESSAGES.INTERNAL_SERVER_ERROR;\n  } else if (error instanceof ClaudeServiceUnavailableError) {\n    errorInfo = ERROR_MESSAGES.SERVICE_UNAVAILABLE;\n  } else if (error instanceof ClaudeRateLimitError) {\n    errorInfo = ERROR_MESSAGES.RATE_LIMIT;\n  } else if (error instanceof ClaudeTimeoutError) {\n    errorInfo = ERROR_MESSAGES.TIMEOUT;\n  } else if (error instanceof ClaudeNetworkError) {\n    errorInfo = ERROR_MESSAGES.NETWORK_ERROR;\n  } else if (error instanceof ClaudeAuthenticationError) {\n    errorInfo = ERROR_MESSAGES.AUTHENTICATION;\n  } else if (error instanceof ClaudeValidationError) {\n    errorInfo = ERROR_MESSAGES.VALIDATION;\n  }\n\n  return {\n    ...errorInfo,\n    retryable: error.retryable,\n  };\n}"],"names":["ClaudeFlowError","ClaudeAPIError","message","statusCode","retryable","details","name","ClaudeInternalServerError","ClaudeServiceUnavailableError","ClaudeRateLimitError","retryAfter","ClaudeTimeoutError","timeout","undefined","ClaudeNetworkError","ClaudeAuthenticationError","ClaudeValidationError","ERROR_MESSAGES","INTERNAL_SERVER_ERROR","title","suggestions","SERVICE_UNAVAILABLE","RATE_LIMIT","TIMEOUT","NETWORK_ERROR","AUTHENTICATION","VALIDATION","getUserFriendlyError","error","errorInfo"],"mappings":"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"}